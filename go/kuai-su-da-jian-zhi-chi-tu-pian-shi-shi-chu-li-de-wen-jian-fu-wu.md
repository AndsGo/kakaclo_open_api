---
description: xulin
---

# ğŸ–¼ï¸ å¿«é€Ÿæ­å»ºæ”¯æŒå›¾ç‰‡å®æ—¶å¤„ç†çš„æ–‡ä»¶æœåŠ¡

## ä½¿ç”¨ slimfiler æ„å»ºé«˜æ•ˆçš„æ–‡ä»¶æœåŠ¡å™¨

åœ¨ç°ä»£ Web å¼€å‘ä¸­ï¼Œæ–‡ä»¶ç®¡ç†æ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œå°¤å…¶æ˜¯**å›¾ç‰‡**çš„å¤„ç†å’Œå­˜å‚¨ã€‚`slimfiler`æ˜¯ä¸€ä¸ªç”¨ Go è¯­è¨€å¼€å‘çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œå®ƒä¸ä»…æ”¯æŒæ–‡ä»¶çš„ä¸Šä¼ ã€ä¸‹è½½å’Œç®¡ç†ï¼Œè¿˜å†…ç½®äº†å¼ºå¤§çš„å›¾ç‰‡å¤„ç†åŠŸèƒ½ï¼Œä¾‹å¦‚**ç¼©æ”¾**ã€**è£å‰ª**å’Œ**æ ¼å¼è½¬æ¢**ã€‚æ›´å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ`slimfiler`çš„å›¾ç‰‡å¤„ç†åŠŸèƒ½å…¼å®¹ `aliyun OSS` å›¾ç‰‡å¤„ç†å‚æ•°ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥è½»æ¾è¿ç§»æˆ–é›†æˆç°æœ‰çš„å›¾ç‰‡å¤„ç†é€»è¾‘ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ `slimfiler`æ„å»ºä¸€ä¸ªé«˜æ•ˆçš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œå¹¶å±•ç¤ºå…¶å¼ºå¤§çš„å›¾ç‰‡å¤„ç†åŠŸèƒ½ã€‚

***

### SlimFiler çš„æ ¸å¿ƒåŠŸèƒ½

1. **æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½** `slimfiler`æä¾›äº†ç®€å•æ˜“ç”¨çš„ API æ¥å¤„ç†æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆå¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€äº‘å­˜å‚¨ç­‰ï¼‰ã€‚
2. **å›¾ç‰‡å¤„ç†** `slimfiler`å†…ç½®äº†å¼ºå¤§çš„å›¾ç‰‡å¤„ç†åŠŸèƒ½ï¼Œæ”¯æŒä»¥ä¸‹æ“ä½œï¼š
   * ç¼©æ”¾ï¼ˆresizeï¼‰
   * è£å‰ªï¼ˆcropï¼‰
   * æ ¼å¼è½¬æ¢ï¼ˆå¦‚å°† PNG è½¬æ¢ä¸º JPGï¼‰
   * æ—‹è½¬ï¼ˆrotateï¼‰
   * æ°´å°ï¼ˆwatermarkï¼‰ç­‰åŠŸèƒ½
3. **å…¼å®¹ Aliyun OSS å‚æ•°** `slimfiler`çš„å›¾ç‰‡å¤„ç†å‚æ•°ä¸é˜¿é‡Œäº‘ OSS å›¾ç‰‡å¤„ç†å‚æ•°å®Œå…¨å…¼å®¹ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨é˜¿é‡Œäº‘ OSS çš„å›¾ç‰‡å¤„ç†å‚æ•°æ¥å¤„ç†å›¾ç‰‡ã€‚
4. **è½»é‡é«˜æ•ˆ** ç”±äºæ˜¯ç”¨ Go è¯­è¨€å¼€å‘çš„ï¼Œ`slimfiler`å…·æœ‰é«˜æ€§èƒ½å’Œä½èµ„æºå ç”¨çš„ç‰¹ç‚¹ï¼Œé€‚åˆå¤„ç†é«˜å¹¶å‘çš„æ–‡ä»¶è¯·æ±‚ã€‚

***

### å®‰è£… SlimFiler

è¦ä½¿ç”¨ `slimfiler`ï¼Œé¦–å…ˆéœ€è¦å°†å…¶å®‰è£…åˆ°ä½ çš„å¼€å‘ç¯å¢ƒä¸­ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®‰è£…ï¼š

1.  å…‹éš† `slimfiler`çš„ GitHub ä»“åº“ï¼š

    ```
    git clone https://github.com/AndsGo/slimfiler.git
    cd slimfiler
    ```
2.  ä½¿ç”¨ Go ç¼–è¯‘å¹¶è¿è¡Œï¼š

    ```
    go build -o slimfiler
    ./slimfiler
    ```
3.  æˆ–è€…ç›´æ¥ä¸‹è½½æ‰§è¡ŒåŒ…ç›´æ¥è¿è¡Œï¼š

    linux [ä¸‹è½½](https://github.com/AndsGo/SlimFiler/releases/download/v1.1.0/slimfiler)

    windows [ä¸‹è½½](https://github.com/AndsGo/SlimFiler/releases/download/v1.1.0/slimfiler.exe)

    é…ç½®æ–‡ä»¶ [ä¸‹è½½](https://github.com/AndsGo/slimfiler/releases/download/v1.1.0/conf.yaml)

    ```
    slimfiler -f ./conf.yaml
    ```

    or

    ```
    slimfiler.exe -f ./conf.yaml
    ```

***

### é…ç½® SlimFiler

`slimfiler`çš„é…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ªç®€å•çš„ YAML æ–‡ä»¶ã€‚

é»˜è®¤ä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼Œå¯ä»¥åˆ‡æ¢æˆæ”¯æŒS3åè®®çš„å¯¹è±¡å­˜å‚¨ï¼Œå¦‚`minio`,`AWS s3`,`aliyun oss`

```yaml
Name: aigc
Port: 8000
UploadConf:
  MaxImageSize: 33554432 Â # 32 mb
  MaxVideoSize: 1073741824 # 1gb
  MaxAudioSize: 33554432 Â # 32mb
  MaxOtherSize: 10485760 Â # 10 mb
  ServerURL: "" # nginx path
  Node: DiskOptions
  DiskOptions:
 Â   DiskPath: "./data/file/public"
  S3Options:
 Â   Bucket: ""
 Â   Endpoint: ""
 Â   SecretId: ""
 Â   SecretKey: ""
 Â   Region: ""
 Â   Token: ""
 Â   S3ForcePathStyle: true
 Â   DisableSSL: false
PorxyCacheConf:
  MaxCacheSize: 10485760 # 10M
  Node: DiskOptions 
  DiskOptions:
 Â   DiskPath: "./data/cache" # ä¸€èˆ¬åœ¨ /tmp ä¸‹
  S3Options:
 Â   Bucket: ""
 Â   Endpoint: ""
 Â   SecretId: ""
 Â   SecretKey: ""
 Â   Region: ""
 Â   Token: ""
 Â   S3ForcePathStyle: true
 Â   DisableSSL: false
Db:
  Path: ./data/file/db/slimfiler.db
  BuketName: "slimfiler" # difualt bucket name
Log:
  FileName: slimfilerLog
  Path: ./data/logs
  Level: info
  Compress: false
  KeepDays: 7
  StackCoolDownMillis: 100
```

### ä½¿ç”¨ SlimFiler å¤„ç†æ–‡ä»¶

#### 1. æ–‡ä»¶ä¸Šä¼ 

ä½¿ç”¨ `slimfiler`ä¸Šä¼ æ–‡ä»¶éå¸¸ç®€å•ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ `curl` ä¸Šä¼ æ–‡ä»¶çš„ç¤ºä¾‹ï¼š

```sh
curl -X POST -F "file=@/path/to/your/image.jpg" http://localhost:8080/upload
```

ä¸Šä¼ æˆåŠŸåï¼Œ`slimfiler` ä¼šè¿”å›æ–‡ä»¶`url`ï¼Œç”¨äºåç»­çš„æ–‡ä»¶è®¿é—®å’Œå¤„ç†ã€‚

#### 2. æ–‡ä»¶æŸ¥çœ‹/ä¸‹è½½

é€šè¿‡æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½æ–‡ä»¶ï¼š

```sh
curl -O http://127.0.0.1:8080/data/test/2025-02-07/987cb8c4-f7f8-4b1e-940a-f9dee03e6ec8.jpg
```

#### 3. æ–‡ä»¶ä»£ç†

ä»£ç† å°†éœ€è¦ä»£ç†çš„`url`è¿½åŠ åˆ° `/proxy/`åé¢

```
http://127.0.0.1:8000/proxy/https://raw.githubusercontent.com/AndsGo/imageprocess/refs/heads/main/examples/example.jpg
```

æ–‡ä»¶ä»£ç†æ”¯æŒç¼“å­˜ï¼Œå¯ä»¥ç”¨äºç®€å•çš„å†…ç½‘CDNåŠ é€Ÿã€‚

ä¾‹å¦‚ä¸Šé¢çš„é“¾æ¥[https://raw.githubusercontent.com/AndsGo/imageprocess/refs/heads/main/examples/example.jpg](https://raw.githubusercontent.com/AndsGo/imageprocess/refs/heads/main/examples/example.jpg)

æˆ‘ç›´æ¥è®¿é—®éœ€è¦ 2s,ä»£ç†ç¼“å­˜åï¼Œ

<figure><img src="../.gitbook/assets/image-20250212210515191.png" alt=""><figcaption></figcaption></figure>

å†é‡æ–°è®¿é—®åªéœ€è¦38msï¼š

<figure><img src="../.gitbook/assets/image-20250212210526283.png" alt=""><figcaption></figcaption></figure>

#### 4. å›¾ç‰‡å¤„ç†å‚æ•°

å›¾ç‰‡å¤„ç†ä¾èµ–[imageprocessåº“](https://github.com/AndsGo/imageprocess),å›¾ç‰‡æŸ¥çœ‹å’Œä»£ç†éƒ½æ”¯æŒå›¾ç‰‡å‹ç¼©ã€‚ å›¾ç‰‡å¤„ç†å…¼å®¹ `aliyun oss` çš„å›¾ç‰‡å¤„ç†ï¼Œåœ¨urlåé¢æ·»åŠ å‚æ•°`x-oss-process`å³å¯ã€‚æ”¯æŒå›¾ç‰‡æ ¼å¼ï¼š`WEBP`,`JPG`,`JPEG`,`PNG`,`BMP`,`TIFF`,`GIF`ã€‚æ–‡ä»¶æŸ¥çœ‹/ä¸‹è½½ å’Œ æ–‡ä»¶ä»£ç†éƒ½æ”¯æŒå›¾ç‰‡å¤„ç†ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å›¾ç‰‡å¤„ç†ç¤ºä¾‹ï¼š

*   **ç¼©æ”¾å›¾ç‰‡** å°†å›¾ç‰‡å®½åº¦è°ƒæ•´ä¸º 300pxï¼Œé«˜åº¦æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼š

    ```
    ?x-oss-process=image/resize,w_300
    ```
*   **è£å‰ªå›¾ç‰‡** å°†å›¾ç‰‡è£å‰ªä¸º 200x200 çš„å¤§å°ï¼š

    ```
    ?x-oss-process=image/crop,w_200,h_200
    ```
*   **æ ¼å¼è½¬æ¢** å°†å›¾ç‰‡è½¬æ¢ä¸º `webp`æ ¼å¼, `webp`ä½œä¸ºæ–°ä¸€ä»£å›¾ç‰‡æ ¼å¼ä½“ç§¯ä¼šå˜å°ä¸å°‘ï¼š

    ```
    ?x-oss-process=image/format,webp
    ```
*   **æ·»åŠ æ°´å°** åœ¨å›¾ç‰‡å³ä¸‹è§’æ·»åŠ æ–‡å­—æ°´å°ï¼š

    ```
    ?x-oss-process=image/watermark,text_SlimFiler,color_FFFFFF,size_20,g_se,x_10,y_10
    ```

è¿™äº›å‚æ•°ä¸é˜¿é‡Œäº‘ OSS å®Œå…¨å…¼å®¹ï¼Œå› æ­¤ä½ å¯ä»¥ç›´æ¥å°†ç°æœ‰çš„ OSS å›¾ç‰‡å¤„ç†é€»è¾‘è¿ç§»åˆ° `slimfiler`ã€‚

å›¾ç‰‡å¤„ç†åŠŸèƒ½ä½¿ç”¨

***

### æ€»ç»“

`flimfiler`æ˜¯ä¸€ä¸ªåŠŸèƒ½ç®€å•ä¸”æ˜“äºä½¿ç”¨çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦å¤„ç†å›¾ç‰‡çš„ Web åº”ç”¨ã€‚å®ƒæ”¯æŒæ–‡ä»¶çš„ä¸Šä¼ ã€ä¸‹è½½å’Œç®¡ç†ï¼Œå¹¶å†…ç½®äº†ä¸é˜¿é‡Œäº‘ OSS å…¼å®¹çš„å›¾ç‰‡å¤„ç†åŠŸèƒ½ã€‚é€šè¿‡ç®€å•çš„é…ç½®å’Œçµæ´»çš„ APIï¼Œ`flimfiler`å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ„å»ºé«˜æ•ˆçš„æ–‡ä»¶æœåŠ¡ã€‚

å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªè½»é‡çº§ä¸”æ”¯æŒå›¾ç‰‡å®æ—¶å¤„ç†çš„çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œ`slimfiler` ç»å¯¹æ˜¯ä¸€ä¸ªå€¼å¾—å°è¯•çš„å·¥å…·ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè®¿é—® [GitHub ä»“åº“](https://github.com/AndsGo/slimfiler)ã€‚

\
